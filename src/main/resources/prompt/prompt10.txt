# Role
ä½ æ˜¯ä¸€åèµ„æ·±çš„ Java Spring Boot å…¨æ ˆå¼€å‘å·¥ç¨‹å¸ˆã€‚
æˆ‘æ­£åœ¨å¼€å‘â€œä¸­å›½æ—…æ¸¸åŠ©æ‰‹â€é¡¹ç›®ï¼ˆSpring Boot + MyBatis + HTMLï¼‰ï¼Œç°åœ¨éœ€è¦é›†æˆ**é«˜å¾·åœ°å›¾ (Amap) å¤©æ°” API**ã€‚
ç›®æ ‡æ˜¯åœ¨â€œæ™¯ç‚¹è¯¦æƒ…é¡µâ€ (`detail.html`) å±•ç¤ºè¯¥æ™¯ç‚¹æ‰€åœ¨åŸå¸‚çš„**æœªæ¥ 4-5 å¤©å¤©æ°”é¢„æŠ¥**ã€‚

# Context (ç°æœ‰èµ„æº)
1.  **é«˜å¾· API æ–‡æ¡£å‚è€ƒ**ï¼š
    * è¯·æ±‚åœ°å€ï¼š`https://restapi.amap.com/v3/weather/weatherInfo`
    * è¯·æ±‚æ–¹å¼ï¼š`GET`
    * æ ¸å¿ƒå‚æ•°ï¼š`key` (æˆ‘çš„APIå¯†é’¥), `city` (åŸå¸‚Adcodeï¼Œå¦‚ 110101), `extensions=all` (allä»£è¡¨é¢„æŠ¥ï¼Œbaseä»£è¡¨å®å†µ)ã€‚
    * **å“åº”ç»“æ„ (JSON)**ï¼š
        ```json
        {
            "status": "1",
            "forecasts": [
                {
                    "city": "æ­¦æ±‰å¸‚",
                    "adcode": "420100",
                    "casts": [
                        { "date": "2023-12-21", "dayweather": "æ™´", "nightweather": "å¤šäº‘", "daytemp": "10", "nighttemp": "2" },
                        ... // æœªæ¥å‡ å¤©çš„æ•°æ®
                    ]
                }
            ]
        }
        ```

2.  **ç°æœ‰é¡¹ç›®ç»“æ„**ï¼š
    * `Attraction` (æ™¯ç‚¹) å…³è” `City` (åŸå¸‚)ã€‚
    * `City` è¡¨ç›®å‰åªæœ‰ `name` (å¦‚ "æ­¦æ±‰å¸‚")ï¼Œ**ç¼ºå°‘é«˜å¾·éœ€è¦çš„ adcode**ã€‚

# Task (ä»»åŠ¡æ¸…å•)
è¯·å¸®æˆ‘å®Œæˆä»¥ä¸‹ 5 é¡¹å·¥ä½œï¼š

## 1. æ•°æ®åº“å˜æ›´ (Database Changes)
é«˜å¾· API å¿…é¡»ä½¿ç”¨ `adcode` (è¡Œæ”¿åŒºåˆ’ä»£ç )ã€‚
* è¯·æä¾› SQL è¯­å¥ï¼š
    1.  ä¿®æ”¹ `city` è¡¨ï¼Œæ–°å¢ `adcode` å­—æ®µ (varchar 20)ã€‚
    2.  æä¾›ä¸€æ¡ `UPDATE` è¯­å¥ï¼Œå°†â€œæ­¦æ±‰å¸‚â€çš„ adcode æ›´æ–°ä¸º `420100`ï¼Œä»¥ä¾¿æˆ‘è¿›è¡Œæµ‹è¯•ã€‚
* è¯·åŒæ­¥ä¿®æ”¹ `City.java` å®ä½“ç±»ï¼Œå¢åŠ  `adcode` å±æ€§ã€‚

## 2. åç«¯é…ç½®ä¸ä¾èµ– (Configuration)
* **ä¾èµ–**ï¼šå¦‚æœéœ€è¦å‘é€ HTTP è¯·æ±‚ï¼Œè¯·æ¨èä½¿ç”¨ Spring è‡ªå¸¦çš„ `RestTemplate` æˆ–è½»é‡çº§çš„ `OkHttp`ï¼ˆè¯·ç»™å‡º `pom.xml` ä¾èµ–ä»£ç ï¼‰ã€‚
* **é…ç½®**ï¼šè¯·åœ¨ `application.yml` ä¸­é¢„ç•™é«˜å¾· Key çš„é…ç½®é¡¹ï¼ˆ`amap.key`ï¼‰ã€‚

## 3. åç«¯ä¸šåŠ¡é€»è¾‘ (Service Layer)
* åˆ›å»º `AmapWeatherService.java`ã€‚
* å®ç°æ–¹æ³• `getWeatherForecast(String adcode)`ï¼š
    * ä½¿ç”¨ `RestTemplate` å‘èµ· GET è¯·æ±‚ã€‚
    * **URL æ‹¼æ¥**ï¼š`https://restapi.amap.com/v3/weather/weatherInfo?city={adcode}&key={key}&extensions=all`
    * **æ•°æ®æ¸…æ´—**ï¼šè§£æé«˜å¾·è¿”å›çš„å¤æ‚ JSONï¼Œåªæå– `casts` æ•°ç»„ï¼ˆæ—¥æœŸã€å¤©æ°”ç°è±¡ã€æ¸©åº¦ï¼‰ï¼Œå°è£…æˆä¸€ä¸ªç®€å•çš„ `List<WeatherDTO>` è¿”å›ã€‚ä¸è¦æŠŠé«˜å¾·çš„æ‰€æœ‰å­—æ®µéƒ½æ‰”ç»™å‰ç«¯ã€‚

## 4. åç«¯æ¥å£ (Controller Layer)
* åœ¨ `AttractionController` æˆ–æ–°å»º `WeatherController` ä¸­æä¾›æ¥å£ï¼š
    * `GET /api/weather/forecast?attractionId={id}`
    * **é€»è¾‘**ï¼šæ ¹æ®æ™¯ç‚¹ID -> æŸ¥ `Attraction` -> æŸ¥ `City` -> æ‹¿åˆ° `adcode` -> è°ƒç”¨ `AmapWeatherService` -> è¿”å›æ•°æ®ã€‚

## 5. å‰ç«¯å±•ç¤º (Frontend - detail.html)
* è¯·æä¾› HTML å’Œ JavaScript (jQuery) ä»£ç ã€‚
* **UI å¸ƒå±€**ï¼šåœ¨æ™¯ç‚¹ä»‹ç»ä¸‹æ–¹æ·»åŠ ä¸€ä¸ªâ€œæœªæ¥å¤©æ°”â€æ¨¡å—ã€‚
* **æ ·å¼**ï¼šä½¿ç”¨ Flex å¸ƒå±€æ¨ªå‘æ’åˆ— 4-5 ä¸ªå¡ç‰‡ã€‚æ¯ä¸ªå¡ç‰‡åŒ…å«ï¼š
    * æ—¥æœŸï¼ˆå¦‚ "å‘¨ä¸‰" æˆ– "12-21"ï¼‰
    * å¤©æ°”å›¾æ ‡ï¼ˆä½ å¯ä»¥ä½¿ç”¨ Emoji ğŸŒ¤ï¸ ğŸŒ§ï¸ æˆ–è€…ç®€å•çš„æ–‡å­—ä»£æ›¿ï¼‰
    * æ¸©åº¦èŒƒå›´ï¼ˆå¦‚ "5Â°C ~ 12Â°C"ï¼‰
* **äº¤äº’**ï¼šé¡µé¢åŠ è½½å®Œæˆåï¼Œè‡ªåŠ¨è°ƒç”¨ä¸Šè¿° API å¹¶æ¸²æŸ“å¡ç‰‡ã€‚

# Constraints (çº¦æŸ)
* ä»£ç å¿…é¡»é€‚é… **Java 21** å’Œ **Spring Boot 3.x**ã€‚
* JSON å¤„ç†è¯·ä½¿ç”¨ **Jackson** (Spring Boot é»˜è®¤) æˆ– FastJsonã€‚
* è¯·åšå¥½**å¼‚å¸¸å¤„ç†**ï¼šå¦‚æœ `city` çš„ `adcode` ä¸ºç©ºï¼Œæˆ–è€…é«˜å¾· API è°ƒç”¨å¤±è´¥ï¼Œæ¥å£ä¸åº”æŠ¥é”™ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªç©ºåˆ—è¡¨ï¼Œå‰ç«¯æ˜¾ç¤ºâ€œæš‚æ— å¤©æ°”æ•°æ®â€ã€‚

è¯·å¼€å§‹ç”Ÿæˆä»£ç ã€‚

æˆ‘çš„æ•°æ®åº“è„šæœ¬å¦‚ä¸‹ï¼šcreate table province
          (
              id          bigint auto_increment comment 'çœä»½ID'
                  primary key,
              name        varchar(50)                         not null comment 'çœä»½åç§°',
              map_code    varchar(20)                         not null comment 'EChartsåœ°å›¾ä»£ç ',
              create_time timestamp default CURRENT_TIMESTAMP null comment 'åˆ›å»ºæ—¶é—´',
              constraint name
                  unique (name)
          )
              comment 'çœä»½è¡¨' charset = utf8mb4;

          create table city
          (
              id          bigint auto_increment comment 'åŸå¸‚ID'
                  primary key,
              province_id bigint                              not null comment 'æ‰€å±çœä»½ID',
              name        varchar(50)                         not null comment 'åŸå¸‚åç§°',
              description text                                null comment 'åŸå¸‚æè¿°',
              create_time timestamp default CURRENT_TIMESTAMP null comment 'åˆ›å»ºæ—¶é—´',
              constraint city_ibfk_1
                  foreign key (province_id) references province (id)
                      on delete cascade
          )
              comment 'åŸå¸‚è¡¨' charset = utf8mb4;

          create table attraction
          (
              id             bigint auto_increment comment 'æ™¯ç‚¹ID'
                  primary key,
              city_id        bigint                                  not null comment 'æ‰€å±åŸå¸‚ID',
              name           varchar(100)                            not null comment 'æ™¯ç‚¹åç§°',
              image_url      varchar(500)                            null comment 'æ™¯ç‚¹å›¾ç‰‡URL',
              description    text                                    null comment 'æ™¯ç‚¹æè¿°',
              view_count     int           default 0                 null comment 'æµè§ˆæ¬¡æ•°',
              rating         decimal(3, 1) default 0.0               null comment 'è¯„åˆ†(0.0-5.0)',
              create_time    timestamp     default CURRENT_TIMESTAMP null comment 'åˆ›å»ºæ—¶é—´',
              strategy_guide text                                    null comment 'æ—…æ¸¸æ”»ç•¥',
              constraint attraction_ibfk_1
                  foreign key (city_id) references city (id)
                      on delete cascade
          )
              comment 'æ™¯ç‚¹è¡¨' charset = utf8mb4;

          create index idx_city_id
              on attraction (city_id);

          create index idx_rating
              on attraction (rating);

          create index idx_province_id
              on city (province_id);

          create index idx_map_code
              on province (map_code);

          create table users
          (
              id          bigint auto_increment comment 'ç”¨æˆ·ID'
                  primary key,
              username    varchar(50)                         not null comment 'ç”¨æˆ·å',
              password    varchar(255)                        not null comment 'å¯†ç ',
              create_time timestamp default CURRENT_TIMESTAMP null comment 'åˆ›å»ºæ—¶é—´',
              update_time timestamp default CURRENT_TIMESTAMP null on update CURRENT_TIMESTAMP comment 'æ›´æ–°æ—¶é—´',
              constraint username
                  unique (username)
          )
              comment 'ç”¨æˆ·è¡¨' charset = utf8mb4;

          create table comment
          (
              id            bigint auto_increment comment 'è¯„è®ºID'
                  primary key,
              attraction_id bigint                              not null comment 'æ™¯ç‚¹ID',
              user_id       bigint                              not null comment 'ç”¨æˆ·ID',
              content       text                                not null comment 'è¯„è®ºå†…å®¹',
              create_time   timestamp default CURRENT_TIMESTAMP null comment 'åˆ›å»ºæ—¶é—´',
              constraint comment_ibfk_1
                  foreign key (attraction_id) references attraction (id)
                      on delete cascade,
              constraint comment_ibfk_2
                  foreign key (user_id) references users (id)
                      on delete cascade
          )
              comment 'è¯„è®ºè¡¨' charset = utf8mb4;

          create index idx_attraction_id
              on comment (attraction_id);

          create index idx_create_time
              on comment (create_time);

          create index idx_user_id
              on comment (user_id);

          create index idx_username
              on users (username);


