基于我从三个阿里云 OSS 官方文档中读取的内容,现在为您生成技术规范文档:

  ---
  阿里云 OSS 上传功能技术要点

  1. Maven 依赖配置

  1.1 核心依赖 (V1 版本)

  <dependency>
      <groupId>com.aliyun.oss</groupId>
      <artifactId>aliyun-sdk-oss</artifactId>
      <version>3.17.4</version>
  </dependency>

  1.2 Java 9+ 需额外添加 JAXB 依赖

  <!-- JAXB API -->
  <dependency>
      <groupId>javax.xml.bind</groupId>
      <artifactId>jaxb-api</artifactId>
      <version>2.3.1</version>
  </dependency>

  <!-- Java Activation -->
  <dependency>
      <groupId>javax.activation</groupId>
      <artifactId>activation</artifactId>
      <version>1.1.1</version>
  </dependency>

  <!-- JAXB Runtime (版本不超过 2.3.3) -->
  <dependency>
      <groupId>org.glassfish.jaxb</groupId>
      <artifactId>jaxb-runtime</artifactId>
      <version>2.3.3</version>
  </dependency>

  ---
  2. 核心配置参数

  | 参数名          | 说明                        | 示例值                                |
  |-----------------|-----------------------------|---------------------------------------|
  | endpoint        | OSS 访问域名(外网/内网)     | https://oss-cn-hangzhou.aliyuncs.com  |
  | accessKeyId     | RAM 用户 Access Key ID      | 从环境变量 OSS_ACCESS_KEY_ID 读取     |
  | accessKeySecret | RAM 用户 Access Key Secret  | 从环境变量 OSS_ACCESS_KEY_SECRET 读取 |
  | bucketName      | 存储空间名称                | examplebucket                         |
  | region          | 地域 ID(使用 V4 签名时必须) | cn-hangzhou                           |

  重要提示:
  - 生产环境强烈推荐使用 V4 签名算法(安全要求)
  - V4 签名必须配置 region 参数

  ---
  3. OSSClient 初始化 (使用 OSSClientBuilder)

  3.1 基础初始化代码

  import com.aliyun.oss.*;
  import com.aliyun.oss.common.auth.*;
  import com.aliyun.oss.common.comm.SignVersion;

  // 从环境变量获取访问凭证
  EnvironmentVariableCredentialsProvider credentialsProvider =
      CredentialsProviderFactory.newEnvironmentVariableCredentialsProvider();

  // 配置客户端参数
  ClientBuilderConfiguration clientBuilderConfiguration =
      new ClientBuilderConfiguration();
  clientBuilderConfiguration.setSignatureVersion(SignVersion.V4);  // V4 签名

  // 初始化 OSS 客户端
  OSS ossClient = OSSClientBuilder.create()
      .endpoint(endpoint)          // 例如: "https://oss-cn-hangzhou.aliyuncs.com"
      .credentialsProvider(credentialsProvider)
      .clientConfiguration(clientBuilderConfiguration)
      .region(region)              // 例如: "cn-hangzhou" (V4 签名必须)
      .build();

  // 使用完毕后释放资源
  ossClient.shutdown();

  3.2 单例模式推荐(线程安全)

  public class OssClientSingleton {
      private static class SingletonHolder {
          private static final OSS INSTANCE = create();

          private static OSS create() {
              ClientBuilderConfiguration config = new ClientBuilderConfiguration();
              config.setSignatureVersion(SignVersion.V4);

              CredentialsProvider credentialsProvider =
                  CredentialsProviderFactory.newEnvironmentVariableCredentialsProvider();

              return OSSClientBuilder.create()
                  .endpoint("https://oss-cn-hangzhou.aliyuncs.com")
                  .credentialsProvider(credentialsProvider)
                  .clientConfiguration(config)
                  .region("cn-hangzhou")
                  .build();
          }
      }

      public static OSS getInstance() {
          return SingletonHolder.INSTANCE;
      }
  }

  ---
  4. 图片上传核心代码 (putObject + InputStream)

  4.1 流式上传示例

  import com.aliyun.oss.model.PutObjectRequest;
  import com.aliyun.oss.model.PutObjectResult;
  import java.io.ByteArrayInputStream;
  import java.io.FileInputStream;
  import java.io.InputStream;

  // 方式1: 上传字符串/字节数组
  String content = "Hello OSS";
  String objectName = "images/example.jpg";  // Object 完整路径(不含 Bucket 名)

  PutObjectRequest putObjectRequest = new PutObjectRequest(
      bucketName,
      objectName,
      new ByteArrayInputStream(content.getBytes())
  );

  PutObjectResult result = ossClient.putObject(putObjectRequest);
  System.out.println("ETag: " + result.getETag());

  4.2 文件流上传

  // 方式2: 上传文件流
  String filePath = "D:\\localpath\\examplefile.jpg";
  InputStream inputStream = new FileInputStream(filePath);

  PutObjectRequest putObjectRequest = new PutObjectRequest(
      bucketName,
      "images/example.jpg",  // OSS 上的 Object 路径
      inputStream
  );

  PutObjectResult result = ossClient.putObject(putObjectRequest);
  inputStream.close();

  4.3 设置元数据(可选)

  import com.aliyun.oss.model.ObjectMetadata;
  import com.aliyun.oss.internal.OSSHeaders;
  import com.aliyun.oss.model.CannedAccessControlList;
  import com.aliyun.oss.model.StorageClass;

  ObjectMetadata metadata = new ObjectMetadata();
  metadata.setHeader(OSSHeaders.OSS_STORAGE_CLASS, StorageClass.Standard.toString());
  metadata.setObjectAcl(CannedAccessControlList.Private);
  metadata.setContentType("image/jpeg");  // 设置图片类型

  putObjectRequest.setMetadata(metadata);

  ---
  5. 文件公网访问 URL 拼接规则

  5.1 URL 格式

  https://{BucketName}.{Endpoint}/{ObjectKey}

  5.2 拼接示例

  public String buildPublicUrl(String bucketName, String endpoint, String objectKey) {
      // 移除 endpoint 的协议前缀
      String endpointWithoutProtocol = endpoint.replace("https://", "").replace("http://", "");

      // 拼接完整 URL
      return String.format("https://%s.%s/%s", bucketName, endpointWithoutProtocol, objectKey);
  }

  // 实际调用
  String bucketName = "my-bucket";
  String endpoint = "https://oss-cn-hangzhou.aliyuncs.com";
  String objectKey = "images/2024/photo.jpg";

  String publicUrl = buildPublicUrl(bucketName, endpoint, objectKey);
  // 结果: https://my-bucket.oss-cn-hangzhou.aliyuncs.com/images/2024/photo.jpg

  5.3 注意事项

  - ObjectKey 不能包含 Bucket 名称
  - 如果 ObjectKey 包含中文或特殊字符,需要进行 URL 编码
  - 确保 Bucket 的 ACL 允许公共读访问,否则需要使用预签名 URL

  ---
  6. 完整异常处理模板

  try {
      // 上传操作
      PutObjectResult result = ossClient.putObject(putObjectRequest);
      System.out.println("上传成功, ETag: " + result.getETag());

  } catch (OSSException oe) {
      // 服务端异常(请求到达 OSS 但被拒绝)
      System.out.println("Error Message: " + oe.getErrorMessage());
      System.out.println("Error Code: " + oe.getErrorCode());
      System.out.println("Request ID: " + oe.getRequestId());

  } catch (ClientException ce) {
      // 客户端异常(网络问题、DNS 解析失败等)
      System.out.println("Error Message: " + ce.getMessage());

  } finally {
      if (ossClient != null) {
          ossClient.shutdown();
      }
  }

  ---
  7. Spring Boot 配置类示例

  @Configuration
  public class OssConfig {

      @Value("${aliyun.oss.endpoint}")
      private String endpoint;

      @Value("${aliyun.oss.region}")
      private String region;

      @Bean
      public OSS ossClient() {
          EnvironmentVariableCredentialsProvider credentialsProvider =
              CredentialsProviderFactory.newEnvironmentVariableCredentialsProvider();

          ClientBuilderConfiguration config = new ClientBuilderConfiguration();
          config.setSignatureVersion(SignVersion.V4);

          return OSSClientBuilder.create()
              .endpoint(endpoint)
              .credentialsProvider(credentialsProvider)
              .clientConfiguration(config)
              .region(region)
              .build();
      }
  }

  application.yml:
  aliyun:
    oss:
      endpoint: https://oss-cn-hangzhou.aliyuncs.com
      region: cn-hangzhou
