<!DOCTYPE html>
<html lang="zh-CN"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>æ—…è¡Œè´¦æœ¬ - ä¸­å›½æ—…æ¸¸åŠ©æ‰‹</title> <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> <style> * { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f5f7fa;
}

.navbar {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 15px 50px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.navbar-brand {
    color: white;
    font-size: 24px;
    font-weight: bold;
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
}

.navbar-user {
    display: flex;
    align-items: center;
    gap: 20px;
    color: white;
}

.back-btn {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    border: 1px solid white;
    padding: 8px 20px;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
}

.back-btn:hover {
    background: white;
    color: #667eea;
}

.container {
    max-width: 1200px;
    margin: 50px auto;
    padding: 0 20px;
}

.page-title {
    font-size: 32px;
    color: #333;
    margin-bottom: 40px;
    text-align: center;
}

.ledger-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 30px;
}

.ledger-card {
    background: white;
    border-radius: 15px;
    padding: 30px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    cursor: pointer;
    transition: all 0.3s ease;
    border: 2px solid transparent;
}

.ledger-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    border-color: #667eea;
}

.ledger-icon {
    font-size: 48px;
    margin-bottom: 15px;
}

.ledger-title {
    font-size: 20px;
    font-weight: bold;
    color: #333;
    margin-bottom: 10px;
}

.ledger-meta {
    font-size: 14px;
    color: #666;
    margin-bottom: 5px;
}

.empty-state {
    text-align: center;
    padding: 80px 20px;
    color: #999;
}

.empty-icon {
    font-size: 80px;
    margin-bottom: 20px;
}
</style>
</head> <body> <nav class="navbar"> <div class="navbar-brand" onclick="window.location.href='home.html'"> ğŸ’° æ—…è¡Œè´¦æœ¬ </div> <div class="navbar-user"> <div>å½“å‰ç”¨æˆ·ï¼š<span id="username"></span></div> <a href="home.html" class="back-btn">â† è¿”å›é¦–é¡µ</a> </div> </nav>
<div class="container">
    <h1 class="page-title">æˆ‘çš„æ—…è¡Œè´¦æœ¬</h1>

    <div id="ledgerGrid" class="ledger-grid"></div>

    <div id="emptyState" class="empty-state" style="display: none;">
        <div class="empty-icon">ğŸ“</div>
        <div>æš‚æ— æ—…è¡Œè¶³è¿¹</div>
        <div style="margin-top: 10px;">è¯·å…ˆåˆ›å»ºè¶³è¿¹ï¼Œç„¶åå°±å¯ä»¥å¼€å§‹è®°è´¦äº†</div>
    </div>
</div>

<script>
    let currentUser = null;

    $(document).ready(function() {
        const userStr = localStorage.getItem('user');
        if (!userStr) {
            alert('è¯·å…ˆç™»å½•');
            window.location.href = 'login.html';
            return;
        }

        currentUser = JSON.parse(userStr);
        $('#username').text(currentUser.username);

        loadFootprints();
    });

    function loadFootprints() {
        $.ajax({
            url: '/api/footprint/all',
            method: 'GET',
            data: { userId: currentUser.id },
            success: function(response) {
                if (response.code === 200) {
                    const footprints = response.data;

                    if (footprints.length === 0) {
                        $('#emptyState').show();
                        $('#ledgerGrid').hide();
                    } else {
                        $('#emptyState').hide();
                        $('#ledgerGrid').show();
                        displayFootprints(footprints);
                    }
                } else {
                    alert('åŠ è½½å¤±è´¥: ' + response.msg);
                }
            },
            error: function() {
                alert('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');
            }
        });
    }

    function displayFootprints(footprints) {
        const grid = $('#ledgerGrid');
        grid.empty();

        footprints.forEach(f => {
            const dateStr = f.startDate && f.endDate
                ? `${f.startDate} ~ ${f.endDate}`
                : 'æœªè®¾ç½®æ—¥æœŸ';

            const card = $(`
                <div class="ledger-card">
                    <div class="ledger-icon">ğŸ’¼</div>
                    <div class="ledger-title">${f.title}çš„è´¦æœ¬</div>
                    <div class="ledger-meta">ğŸ“ ${f.provinceName}</div>
                    <div class="ledger-meta">ğŸ“… ${dateStr}</div>
                    <div class="ledger-meta">ğŸ‘¤ åˆ›å»ºè€…: ${f.creatorUsername}</div>
                </div>
            `);

            card.click(function() {
                window.location.href = `ledger_detail.html?id=${f.id}`;
            });

            grid.append(card);
        });
    }
</script>
</body> </html>